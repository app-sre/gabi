apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: test-pod-template
  annotations:
    description: "Template for deploying a test pod with the built image"
parameters:
- name: IMAGE_URL
  description: "The container image URL to deploy"
  required: true
- name: POD_NAME
  description: "Name of the pod"
  value: "test-app"
  required: true
objects:
- apiVersion: v1
  kind: Pod
  metadata:
    name: ${POD_NAME}
    labels:
      app: ${POD_NAME}
      env: pipeline-test
  spec:
    restartPolicy: Never
    containers:
    - name: app
      image: ${IMAGE_URL}
      env:
      - name: DB_HOST
        value: database
      - name: DB_PORT
        value: "5432"
      - name: DB_USER
        value: gabi
      - name: DB_PASS
        value: passwd
      - name: DB_NAME
        value: mydb
      - name: EXPIRATION_DATE
        value: 2026-10-17
      - name: SPLUNK_INDEX
        value: main
      - name: SPLUNK_TOKEN
        value: "1234567890"
      - name: SPLUNK_ENDPOINT
        value: https://splunk.example.com
      - name: HOST
        value: test
      - name: NAMESPACE
        value: test
      - name: POD_NAME
        value: ${POD_NAME}
      - name: REQUEST_TIMEOUT
        value: "30s"
      ports:
        - containerPort: 8080
          name: http
    - name: database
      image: registry.redhat.io/rhel9/postgresql-16:9.6
      env:
      - name: POSTGRESQL_USER
        value: gabi
      - name: POSTGRESQL_PASSWORD
        value: passwd
      - name: POSTGRESQL_DATABASE
        value: mydb
      ports:
        - containerPort: 5432
- apiVersion: v1
  kind: Service
  metadata:
    name: ${POD_NAME}-internal
  spec:
    ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: 8080
    selector:
      app: ${POD_NAME}